enum PRoomMessageContentType {
  TEXT
  CONFIG
}

type PUser {
  id: ID! @id
  email: String! @unique
  name: String @unique
  passwordHash: String
  googleId: String
  facebookId: String
  decks: [PDeck!]!
  # https://github.com/prisma/prisma/issues/4424
  roles: [String!]! @scalarList(strategy: RELATION)
  ownerOfRoom: [PRoom!]! @relation(name: "PUserOwningPRooms")
  occupyingRoom: [PRoom!]! @relation(name: "PUsersOccupyingPRooms")
  sentMessages: [PRoomMessage!]!
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

# To refactor message types into inheritance once
# interfaces extending interfaces is implemented
# https://github.com/facebook/graphql/issues/295
# https://github.com/prisma/prisma/issues/83
# https://itnext.io/graphql-interfaces-and-union-types-with-prisma-and-yoga-7224f9e1d9ad

type PCard { # implements Card
  id: ID! @id
  prompt: String!
  fullAnswer: String!
  answers: [String!]! @scalarList(strategy: RELATION)
  sortKey: String!
  editedAt: DateTime!
  template: Boolean!
  deck: PDeck! @relation(link: INLINE)
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type PDeck {
  id: ID! @id
  name: String!
  description: String!
  nameLang: String!
  promptLang: String!
  answerLang: String!
  owner: PUser! @relation(link: INLINE)
  cards: [PCard!]! @relation(onDelete: CASCADE)
  published: Boolean! @default(value: false)
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type PRoom {
  id: ID! @id
  # consistency: at most/latest equal to last (possibly deleted/edited) message in room
  lastKnownActiveMessage: DateTime!
  inactiveOverride: Boolean!
  config: String!
  owner: PUser! @relation(link: INLINE name: "PUserOwningPRooms")
  occupants: [PUser!]! @relation(name: "PUsersOccupyingPRooms")
  messages: [PRoomMessage!]!
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

# Consider refactoring message types into inheritance once
# interfaces extending interfaces is implemented
# https://github.com/facebook/graphql/issues/295
# https://github.com/prisma/prisma/issues/83
# https://itnext.io/graphql-interfaces-and-union-types-with-prisma-and-yoga-7224f9e1d9ad

type PRoomMessage {
  id: ID! @id
  room: PRoom! @relation(link: INLINE)
  sender: PUser @relation(link: INLINE)
  contentType: PRoomMessageContentType!
  content: String!
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}
